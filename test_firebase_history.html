<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste Firebase - Hist√≥rico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-box {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .status-box h3 {
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .status-box pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            box-shadow: 0 6px 20px rgba(245, 101, 101, 0.4);
        }
        
        .sessions-list {
            display: grid;
            gap: 15px;
        }
        
        .session-card {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .session-username {
            font-size: 1.2em;
            font-weight: 700;
            color: #667eea;
        }
        
        .session-time {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .stat-item {
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.1em;
            font-weight: 700;
        }
        
        .profit-positive {
            color: #48bb78;
        }
        
        .profit-negative {
            color: #f56565;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Teste Firebase - Hist√≥rico</h1>
            <p>Teste o sistema de salvamento de sess√µes no Firebase Firestore</p>
        </div>
        
        <div class="status-box">
            <h3>üî• Status da Conex√£o</h3>
            <pre id="statusLog">Aguardando testes...</pre>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="testarConexao()">
                üîå Testar Conex√£o Firebase
            </button>
            <button class="btn btn-success" onclick="criarSessaoTeste()">
                ‚ûï Criar Sess√£o de Teste
            </button>
            <button class="btn btn-primary" onclick="carregarSessoes()">
                üìä Carregar Sess√µes
            </button>
            <button class="btn btn-danger" onclick="limparTudo()">
                üóëÔ∏è Limpar Tudo (CUIDADO!)
            </button>
        </div>
        
        <div class="status-box">
            <h3>üìä Sess√µes Carregadas</h3>
            <div id="sessionsContainer">
                <div class="loading">
                    <p>Clique em "Carregar Sess√µes" para ver os dados</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, limit, deleteDoc, doc, writeBatch } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCWPobM_NmbPG15ulqn9e9z7MKtAdgXjv8",
            authDomain: "champion-bot-2835b.firebaseapp.com",
            projectId: "champion-bot-2835b",
            storageBucket: "champion-bot-2835b.firebasestorage.app",
            messagingSenderId: "1023800590615",
            appId: "1:1023800590615:web:e06a993d07a27626ab3752",
            measurementId: "G-J6C2FDM8M4"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Log de status
        function addLog(message, type = 'info') {
            const statusLog = document.getElementById('statusLog');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            statusLog.textContent += `\n[${timestamp}] ${icon} ${message}`;
            statusLog.scrollTop = statusLog.scrollHeight;
        }

        // Testar conex√£o
        window.testarConexao = async function() {
            addLog('Testando conex√£o com Firebase...', 'info');
            try {
                const testQuery = query(collection(db, 'sessions'), limit(1));
                await getDocs(testQuery);
                addLog('‚úÖ Conex√£o com Firebase estabelecida com sucesso!', 'success');
            } catch (error) {
                addLog(`‚ùå Erro ao conectar: ${error.message}`, 'error');
                console.error(error);
            }
        };

        // Criar sess√£o de teste
        window.criarSessaoTeste = async function() {
            addLog('Criando sess√£o de teste...', 'info');
            try {
                const username = prompt('Digite seu username:') || 'teste_usuario';
                
                const sessionData = {
                    username: username,
                    startTime: new Date(Date.now() - 3600000).toISOString(), // 1h atr√°s
                    endTime: new Date().toISOString(),
                    duration: '1h 00min',
                    strategy: 'Champion Pro',
                    accountType: 'demo',
                    asset: 'R_100',
                    initialBalance: 1000.00,
                    finalBalance: 1050.50 + Math.random() * 100,
                    profit: 50.50 + Math.random() * 100,
                    profitPercent: 5.05 + Math.random() * 10,
                    totalTrades: Math.floor(Math.random() * 20) + 5,
                    wins: Math.floor(Math.random() * 15) + 5,
                    losses: Math.floor(Math.random() * 10),
                    winRate: 65.0 + Math.random() * 20,
                    timestamp: new Date().toISOString(),
                    device: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        language: navigator.language
                    }
                };
                
                const docRef = await addDoc(collection(db, 'sessions'), sessionData);
                addLog(`‚úÖ Sess√£o criada com ID: ${docRef.id}`, 'success');
                addLog(`Username: ${username}`, 'info');
                
                // Recarrega automaticamente
                setTimeout(() => carregarSessoes(), 500);
            } catch (error) {
                addLog(`‚ùå Erro ao criar sess√£o: ${error.message}`, 'error');
                console.error(error);
            }
        };

        // Carregar sess√µes
        window.carregarSessoes = async function() {
            addLog('Carregando sess√µes do Firebase...', 'info');
            try {
                const username = prompt('Digite seu username (ou deixe vazio para ver todas):');
                
                let q;
                if (username && username.trim()) {
                    q = query(
                        collection(db, 'sessions'),
                        where('username', '==', username.trim()),
                        orderBy('timestamp', 'desc'),
                        limit(20)
                    );
                } else {
                    q = query(
                        collection(db, 'sessions'),
                        orderBy('timestamp', 'desc'),
                        limit(20)
                    );
                }
                
                const querySnapshot = await getDocs(q);
                const sessions = [];
                
                querySnapshot.forEach((doc) => {
                    sessions.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                addLog(`‚úÖ ${sessions.length} sess√µes carregadas`, 'success');
                renderSessions(sessions);
            } catch (error) {
                addLog(`‚ùå Erro ao carregar: ${error.message}`, 'error');
                console.error(error);
            }
        };

        // Renderizar sess√µes
        function renderSessions(sessions) {
            const container = document.getElementById('sessionsContainer');
            
            if (sessions.length === 0) {
                container.innerHTML = '<div class="loading"><p>üì≠ Nenhuma sess√£o encontrada</p></div>';
                return;
            }
            
            container.innerHTML = sessions.map(session => {
                const profitClass = session.profit >= 0 ? 'profit-positive' : 'profit-negative';
                const startDate = new Date(session.startTime).toLocaleString('pt-BR');
                
                return `
                    <div class="session-card">
                        <div class="session-header">
                            <div class="session-username">üë§ ${session.username}</div>
                            <div class="session-time">üïê ${startDate}</div>
                        </div>
                        <div class="session-stats">
                            <div class="stat-item">
                                <div class="stat-label">Estrat√©gia</div>
                                <div class="stat-value">${session.strategy}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Ativo</div>
                                <div class="stat-value">${session.asset}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Dura√ß√£o</div>
                                <div class="stat-value">${session.duration}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Lucro</div>
                                <div class="stat-value ${profitClass}">$${session.profit.toFixed(2)}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">% Lucro</div>
                                <div class="stat-value ${profitClass}">${session.profitPercent.toFixed(2)}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Win Rate</div>
                                <div class="stat-value">${session.winRate.toFixed(1)}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Trades</div>
                                <div class="stat-value">${session.totalTrades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Vit√≥rias</div>
                                <div class="stat-value profit-positive">${session.wins}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Derrotas</div>
                                <div class="stat-value profit-negative">${session.losses}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Limpar tudo
        window.limparTudo = async function() {
            if (!confirm('‚ö†Ô∏è TEM CERTEZA que deseja DELETAR TODAS as sess√µes do Firebase?\n\nEsta a√ß√£o N√ÉO pode ser desfeita!')) {
                return;
            }
            
            const confirmText = prompt('Digite "CONFIRMAR" em mai√∫sculas para prosseguir:');
            if (confirmText !== 'CONFIRMAR') {
                addLog('‚ùå Opera√ß√£o cancelada', 'info');
                return;
            }
            
            addLog('üóëÔ∏è Deletando todas as sess√µes...', 'info');
            try {
                const q = query(collection(db, 'sessions'));
                const querySnapshot = await getDocs(q);
                
                const batch = writeBatch(db);
                let count = 0;
                
                querySnapshot.forEach((docSnapshot) => {
                    batch.delete(doc(db, 'sessions', docSnapshot.id));
                    count++;
                });
                
                await batch.commit();
                addLog(`‚úÖ ${count} sess√µes deletadas`, 'success');
                
                // Limpa a visualiza√ß√£o
                document.getElementById('sessionsContainer').innerHTML = '<div class="loading"><p>üì≠ Todas as sess√µes foram deletadas</p></div>';
            } catch (error) {
                addLog(`‚ùå Erro ao deletar: ${error.message}`, 'error');
                console.error(error);
            }
        };

        // Log inicial
        addLog('üî• Firebase inicializado com sucesso!', 'success');
        addLog('üìä Projeto: Champion Bot', 'info');
        addLog('‚úÖ Pronto para testes!', 'success');
    </script>
</body>
</html>
