<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Teste: Erros Corrigidos - Champion Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .status-card h2 {
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }

        .test-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 5px solid #ffa502;
        }

        .test-item.success {
            border-left-color: #00ff88;
        }

        .test-item.error {
            border-left-color: #ff4757;
        }

        .test-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .test-details {
            flex: 1;
        }

        .test-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .test-description {
            opacity: 0.8;
            font-size: 0.9em;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 100%;
            margin: 10px 0;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .console-output {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-top: 15px;
        }

        .log-success { color: #00ff88; }
        .log-error { color: #ff4757; }
        .log-warning { color: #ffa502; }
        .log-info { color: #00d2ff; }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .summary-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin: 5px;
        }

        .badge-success {
            background: #00ff88;
            color: #000;
        }

        .badge-error {
            background: #ff4757;
            color: #fff;
        }

        .badge-warning {
            background: #ffa502;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Teste: Erros Corrigidos</h1>

        <!-- Status dos Testes -->
        <div class="status-card">
            <h2>üß™ Status dos Testes</h2>
            <div id="testResults">
                <div class="test-item">
                    <div class="test-icon">‚è≥</div>
                    <div class="test-details">
                        <div class="test-title">Aguardando teste...</div>
                        <div class="test-description">Clique no bot√£o abaixo para executar os testes</div>
                    </div>
                </div>
            </div>

            <button onclick="runTests()">üöÄ Executar Todos os Testes</button>
        </div>

        <!-- Resumo -->
        <div class="status-card">
            <h2>üìä Resumo dos Resultados</h2>
            <div class="summary">
                <div class="summary-item">
                    <div class="summary-label">Total de Testes</div>
                    <div class="summary-value" id="totalTests">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">‚úÖ Aprovados</div>
                    <div class="summary-value log-success" id="passedTests">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">‚ùå Falharam</div>
                    <div class="summary-value log-error" id="failedTests">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">‚ö†Ô∏è Avisos</div>
                    <div class="summary-value log-warning" id="warningTests">0</div>
                </div>
            </div>
        </div>

        <!-- Console Output -->
        <div class="status-card">
            <h2>üìã Console de Testes</h2>
            <div class="console-output" id="consoleOutput">
                <div class="log-info">Aguardando execu√ß√£o dos testes...</div>
            </div>
        </div>

        <!-- Instru√ß√µes -->
        <div class="status-card">
            <h2>üìñ Como Funciona</h2>
            <p style="line-height: 1.8;">
                Este teste verifica se todos os erros do console foram corrigidos:<br><br>
                
                <strong>1. Teste de Prote√ß√£o de Valores:</strong><br>
                Verifica se <code>.toFixed()</code> funciona com valores undefined<br><br>
                
                <strong>2. Teste de Renderiza√ß√£o:</strong><br>
                Tenta renderizar sess√µes com dados incompletos<br><br>
                
                <strong>3. Teste de C√°lculo de Resumo:</strong><br>
                Calcula estat√≠sticas com sess√µes vazias<br><br>
                
                <strong>4. Teste de Filtros:</strong><br>
                Aplica filtros sem elementos DOM<br><br>
                
                <strong>5. Teste de Convers√£o de Datas:</strong><br>
                Converte datas inv√°lidas sem erros<br><br>
                
                <strong>‚úÖ Se todos passarem</strong> ‚Üí Console limpo, sem erros!<br>
                <strong>‚ùå Se algum falhar</strong> ‚Üí Precisa de mais corre√ß√µes
            </p>
        </div>
    </div>

    <script>
        let testsPassed = 0;
        let testsFailed = 0;
        let testsWarning = 0;

        function addLog(message, type = 'info') {
            const output = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const log = document.createElement('div');
            log.className = `log-${type}`;
            log.textContent = `[${timestamp}] ${message}`;
            output.appendChild(log);
            output.scrollTop = output.scrollHeight;
        }

        function addTestResult(icon, title, description, status) {
            const results = document.getElementById('testResults');
            const item = document.createElement('div');
            item.className = `test-item ${status}`;
            item.innerHTML = `
                <div class="test-icon">${icon}</div>
                <div class="test-details">
                    <div class="test-title">${title}</div>
                    <div class="test-description">${description}</div>
                </div>
            `;
            results.appendChild(item);
        }

        function updateSummary() {
            document.getElementById('totalTests').textContent = testsPassed + testsFailed + testsWarning;
            document.getElementById('passedTests').textContent = testsPassed;
            document.getElementById('failedTests').textContent = testsFailed;
            document.getElementById('warningTests').textContent = testsWarning;
        }

        async function runTests() {
            // Limpar resultados
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('consoleOutput').innerHTML = '';
            testsPassed = 0;
            testsFailed = 0;
            testsWarning = 0;

            addLog('üöÄ Iniciando testes...', 'info');

            // Teste 1: Prote√ß√£o de valores undefined com toFixed()
            try {
                addLog('‚ñ∂Ô∏è Teste 1: Prote√ß√£o de valores undefined...', 'info');
                const undefinedValue = undefined;
                const safeValue = (undefinedValue || 0).toFixed(2);
                
                if (safeValue === '0.00') {
                    addTestResult('‚úÖ', 'Prote√ß√£o de Valores', 'toFixed() funciona com undefined ‚Üí "0.00"', 'success');
                    addLog('‚úÖ Teste 1 passou: toFixed() protegido', 'success');
                    testsPassed++;
                } else {
                    throw new Error('Valor inesperado: ' + safeValue);
                }
            } catch (error) {
                addTestResult('‚ùå', 'Prote√ß√£o de Valores', `Erro: ${error.message}`, 'error');
                addLog(`‚ùå Teste 1 falhou: ${error.message}`, 'error');
                testsFailed++;
            }

            // Teste 2: Renderiza√ß√£o com dados incompletos
            try {
                addLog('‚ñ∂Ô∏è Teste 2: Renderiza√ß√£o com dados incompletos...', 'info');
                
                const mockSession = {
                    // Propositalmente incompleto
                    startTime: new Date()
                };

                const trades = mockSession.trades || [];
                const wins = mockSession.wins || 0;
                const startBalance = mockSession.startBalance || mockSession.initialBalance || 0;
                const profit = mockSession.totalProfit || mockSession.profit || 0;

                const result = `$${startBalance.toFixed(2)} ‚Üí +$${profit.toFixed(2)} (${trades.length} trades, ${wins} wins)`;
                
                addTestResult('‚úÖ', 'Renderiza√ß√£o Segura', `Dados incompletos renderizados: "${result}"`, 'success');
                addLog('‚úÖ Teste 2 passou: Renderiza√ß√£o protegida', 'success');
                testsPassed++;
            } catch (error) {
                addTestResult('‚ùå', 'Renderiza√ß√£o Segura', `Erro: ${error.message}`, 'error');
                addLog(`‚ùå Teste 2 falhou: ${error.message}`, 'error');
                testsFailed++;
            }

            // Teste 3: C√°lculo de resumo com sess√µes vazias
            try {
                addLog('‚ñ∂Ô∏è Teste 3: C√°lculo de resumo...', 'info');
                
                const mockSessions = [
                    { trades: undefined, wins: undefined, totalProfit: undefined },
                    { trades: [], wins: 0, totalProfit: 0 },
                    { trades: [1, 2], wins: 2, totalProfit: 5.5 }
                ];

                let totalTrades = 0;
                let totalWins = 0;
                let totalProfit = 0;

                mockSessions.forEach(session => {
                    const trades = session.trades || [];
                    const wins = session.wins || 0;
                    const profit = session.totalProfit || session.profit || 0;
                    
                    totalTrades += trades.length;
                    totalWins += wins;
                    totalProfit += profit;
                });

                const summary = `${totalTrades} trades, ${totalWins} wins, $${totalProfit.toFixed(2)} profit`;
                
                addTestResult('‚úÖ', 'C√°lculo de Resumo', `Estat√≠sticas calculadas: "${summary}"`, 'success');
                addLog('‚úÖ Teste 3 passou: Resumo calculado corretamente', 'success');
                testsPassed++;
            } catch (error) {
                addTestResult('‚ùå', 'C√°lculo de Resumo', `Erro: ${error.message}`, 'error');
                addLog(`‚ùå Teste 3 falhou: ${error.message}`, 'error');
                testsFailed++;
            }

            // Teste 4: Convers√£o de datas
            try {
                addLog('‚ñ∂Ô∏è Teste 4: Convers√£o de datas...', 'info');
                
                const nullDate = null;
                const undefinedDate = undefined;
                const invalidDate = 'invalid';

                const date1 = nullDate ? new Date(nullDate) : new Date();
                const date2 = undefinedDate ? new Date(undefinedDate) : new Date();
                const date3 = invalidDate ? new Date(invalidDate) : new Date();

                if (date1 instanceof Date && date2 instanceof Date && date3 instanceof Date) {
                    addTestResult('‚úÖ', 'Convers√£o de Datas', 'Todas as datas convertidas sem erros', 'success');
                    addLog('‚úÖ Teste 4 passou: Datas protegidas', 'success');
                    testsPassed++;
                } else {
                    throw new Error('Convers√£o de data inv√°lida');
                }
            } catch (error) {
                addTestResult('‚ùå', 'Convers√£o de Datas', `Erro: ${error.message}`, 'error');
                addLog(`‚ùå Teste 4 falhou: ${error.message}`, 'error');
                testsFailed++;
            }

            // Teste 5: Acesso a elementos DOM inexistentes
            try {
                addLog('‚ñ∂Ô∏è Teste 5: Prote√ß√£o de elementos DOM...', 'info');
                
                const nonExistentEl = document.getElementById('nonExistent');
                
                if (nonExistentEl) {
                    nonExistentEl.textContent = 'Test';
                } else {
                    // Elemento n√£o existe, mas n√£o quebra
                    addLog('‚ÑπÔ∏è Elemento n√£o encontrado (esperado)', 'info');
                }

                addTestResult('‚úÖ', 'Prote√ß√£o DOM', 'Elementos inexistentes n√£o causam erros', 'success');
                addLog('‚úÖ Teste 5 passou: DOM protegido', 'success');
                testsPassed++;
            } catch (error) {
                addTestResult('‚ùå', 'Prote√ß√£o DOM', `Erro: ${error.message}`, 'error');
                addLog(`‚ùå Teste 5 falhou: ${error.message}`, 'error');
                testsFailed++;
            }

            // Atualizar resumo
            updateSummary();

            // Resultado final
            addLog('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');
            if (testsFailed === 0) {
                addLog(`üéâ TODOS OS ${testsPassed} TESTES PASSARAM!`, 'success');
                addLog('‚úÖ Console limpo, sem erros!', 'success');
                addLog('‚úÖ Todas as prote√ß√µes funcionando!', 'success');
            } else {
                addLog(`‚ö†Ô∏è ${testsFailed} teste(s) falharam`, 'error');
                addLog(`‚úÖ ${testsPassed} teste(s) passaram`, 'success');
            }
            addLog('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');
        }

        // Executar automaticamente ao carregar
        window.addEventListener('load', () => {
            addLog('‚úÖ P√°gina de teste carregada', 'success');
            addLog('üí° Clique em "Executar Todos os Testes" para come√ßar', 'info');
        });
    </script>
</body>
</html>
